"use strict";(self.webpackChunkhusker_scope=self.webpackChunkhusker_scope||[]).push([[3665],{3665:function(e,t,n){n.r(t),n.d(t,{BluetoothLeWeb:function(){return d}});var r=n(7762),i=n(4165),a=n(5861),s=n(5671),u=n(3144),c=n(7326),o=n(136),v=n(9388),l=n(7991),p=n(7789);function f(e,t,n){return h.apply(this,arguments)}function h(){return(h=(0,a.Z)((0,i.Z)().mark((function e(t,n,r){var a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.race([t,new Promise((function(e,t){a=setTimeout((function(){return t(r)}),n)}))]).finally((function(){return clearTimeout(a)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var d=function(e){(0,o.Z)(n,e);var t=(0,v.Z)(n);function n(){var e;return(0,s.Z)(this,n),(e=t.apply(this,arguments)).deviceMap=new Map,e.discoveredDevices=new Map,e.scan=null,e.DEFAULT_CONNECTION_TIMEOUT=1e4,e.onAdvertisementReceivedCallback=e.onAdvertisementReceived.bind((0,c.Z)(e)),e.onDisconnectedCallback=e.onDisconnected.bind((0,c.Z)(e)),e.onCharacteristicValueChangedCallback=e.onCharacteristicValueChanged.bind((0,c.Z)(e)),e}return(0,u.Z)(n,[{key:"initialize",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof navigator&&navigator.bluetooth){e.next=2;break}throw this.unavailable("Web Bluetooth API not available in this browser.");case 2:return e.next=4,navigator.bluetooth.getAvailability();case 4:if(e.sent){e.next=7;break}throw this.unavailable("No Bluetooth radio available.");case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isEnabled",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{value:!0});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"enable",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw this.unavailable("enable is not available on web.");case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"disable",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw this.unavailable("disable is not available on web.");case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"startEnabledNotifications",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"stopEnabledNotifications",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"isLocationEnabled",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw this.unavailable("isLocationEnabled is not available on web.");case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"openLocationSettings",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw this.unavailable("openLocationSettings is not available on web.");case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"openBluetoothSettings",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw this.unavailable("openBluetoothSettings is not available on web.");case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"openAppSettings",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw this.unavailable("openAppSettings is not available on web.");case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setDisplayStrings",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"requestDevice",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getFilters(t),e.next=3,navigator.bluetooth.requestDevice({filters:n.length?n:void 0,optionalServices:null===t||void 0===t?void 0:t.optionalServices,acceptAllDevices:0===n.length});case 3:return r=e.sent,this.deviceMap.set(r.id,r),a=this.getBleDevice(r),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"requestLEScan",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.requestBleDeviceOptions=t,n=this.getFilters(t),e.next=4,this.stopLEScan();case 4:return this.discoveredDevices=new Map,navigator.bluetooth.removeEventListener("advertisementreceived",this.onAdvertisementReceivedCallback),navigator.bluetooth.addEventListener("advertisementreceived",this.onAdvertisementReceivedCallback),e.next=9,navigator.bluetooth.requestLEScan({filters:n.length?n:void 0,acceptAllAdvertisements:0===n.length,keepRepeatedDevices:null===t||void 0===t?void 0:t.allowDuplicates});case 9:this.scan=e.sent;case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onAdvertisementReceived",value:function(e){var t,n,r=e.device.id;if(this.deviceMap.set(r,e.device),!this.discoveredDevices.has(r)||(null===(t=this.requestBleDeviceOptions)||void 0===t?void 0:t.allowDuplicates)){this.discoveredDevices.set(r,!0);var i=this.getBleDevice(e.device),a={device:i,localName:i.name,rssi:e.rssi,txPower:e.txPower,manufacturerData:(0,p.GA)(e.manufacturerData),serviceData:(0,p.GA)(e.serviceData),uuids:null===(n=e.uuids)||void 0===n?void 0:n.map(p.JA)};this.notifyListeners("onScanResult",a)}}},{key:"stopLEScan",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(){var t;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(null===(t=this.scan)||void 0===t?void 0:t.active)&&this.scan.stop(),this.scan=null;case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDevices",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r,a=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.bluetooth.getDevices();case 2:return n=e.sent,r=n.map((function(e){return a.deviceMap.set(e.id,e),a.getBleDevice(e)})),e.abrupt("return",{devices:r});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConnectedDevices",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r,a=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.bluetooth.getDevices();case 2:return n=e.sent,r=n.filter((function(e){var t;return null===(t=e.gatt)||void 0===t?void 0:t.connected})).map((function(e){return a.deviceMap.set(e.id,e),a.getBleDevice(e)})),e.abrupt("return",{devices:r});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"connect",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r,a,s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=this.getDeviceFromMap(t.deviceId)).removeEventListener("gattserverdisconnected",this.onDisconnectedCallback),a.addEventListener("gattserverdisconnected",this.onDisconnectedCallback),s=Symbol(),void 0!==a.gatt){e.next=6;break}throw new Error("No gatt server available.");case 6:return e.prev=6,u=null!==(n=t.timeout)&&void 0!==n?n:this.DEFAULT_CONNECTION_TIMEOUT,e.next=10,f(a.gatt.connect(),u,s);case 10:e.next=21;break;case 12:return e.prev=12,e.t0=e.catch(6),e.next=16,null===(r=a.gatt)||void 0===r?void 0:r.disconnect();case 16:if(e.t0!==s){e.next=20;break}throw new Error("Connection timeout");case 20:throw e.t0;case 21:case"end":return e.stop()}}),e,this,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onDisconnected",value:function(e){var t=e.target.id,n="disconnected|".concat(t);this.notifyListeners(n,null)}},{key:"createBond",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw this.unavailable("createBond is not available on web.");case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isBonded",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw this.unavailable("isBonded is not available on web.");case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disconnect",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null===(n=this.getDeviceFromMap(t.deviceId).gatt)||void 0===n||n.disconnect();case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getServices",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,a,s,u,c,o,v,l,p,f,h,d;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=this.getDeviceFromMap(t.deviceId).gatt)||void 0===n?void 0:n.getPrimaryServices();case 2:if(e.t1=a=e.sent,e.t0=null!==e.t1,!e.t0){e.next=6;break}e.t0=void 0!==a;case 6:if(!e.t0){e.next=10;break}e.t2=a,e.next=11;break;case 10:e.t2=[];case 11:s=e.t2,u=[],c=(0,r.Z)(s),e.prev=14,c.s();case 16:if((o=c.n()).done){e.next=48;break}return v=o.value,e.next=20,v.getCharacteristics();case 20:l=e.sent,p=[],f=(0,r.Z)(l),e.prev=23,f.s();case 25:if((h=f.n()).done){e.next=37;break}return d=h.value,e.t3=p,e.t4=d.uuid,e.t5=this.getProperties(d),e.next=32,this.getDescriptors(d);case 32:e.t6=e.sent,e.t7={uuid:e.t4,properties:e.t5,descriptors:e.t6},e.t3.push.call(e.t3,e.t7);case 35:e.next=25;break;case 37:e.next=42;break;case 39:e.prev=39,e.t8=e.catch(23),f.e(e.t8);case 42:return e.prev=42,f.f(),e.finish(42);case 45:u.push({uuid:v.uuid,characteristics:p});case 46:e.next=16;break;case 48:e.next=53;break;case 50:e.prev=50,e.t9=e.catch(14),c.e(e.t9);case 53:return e.prev=53,c.f(),e.finish(53);case 56:return e.abrupt("return",{services:u});case 57:case"end":return e.stop()}}),e,this,[[14,50,53,56],[23,39,42,45]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getDescriptors",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.getDescriptors();case 3:return n=e.sent,e.abrupt("return",n.map((function(e){return{uuid:e.uuid}})));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",[]);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getProperties",value:function(e){return{broadcast:e.properties.broadcast,read:e.properties.read,writeWithoutResponse:e.properties.writeWithoutResponse,write:e.properties.write,notify:e.properties.notify,indicate:e.properties.indicate,authenticatedSignedWrites:e.properties.authenticatedSignedWrites,reliableWrite:e.properties.reliableWrite,writableAuxiliaries:e.properties.writableAuxiliaries}}},{key:"getCharacteristic",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=this.getDeviceFromMap(t.deviceId).gatt)||void 0===n?void 0:n.getPrimaryService(null===t||void 0===t?void 0:t.service);case 2:return r=e.sent,e.abrupt("return",null===r||void 0===r?void 0:r.getCharacteristic(null===t||void 0===t?void 0:t.characteristic));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDescriptor",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCharacteristic(t);case 2:return n=e.sent,e.abrupt("return",null===n||void 0===n?void 0:n.getDescriptor(null===t||void 0===t?void 0:t.descriptor));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"discoverServices",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw this.unavailable("discoverServices is not available on web.");case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMtu",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw this.unavailable("getMtu is not available on web.");case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"requestConnectionPriority",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw this.unavailable("requestConnectionPriority is not available on web.");case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readRssi",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw this.unavailable("readRssi is not available on web.");case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"read",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCharacteristic(t);case 2:return n=e.sent,e.next=5,null===n||void 0===n?void 0:n.readValue();case 5:return r=e.sent,e.abrupt("return",{value:r});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"write",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCharacteristic(t);case 2:return n=e.sent,r="string"===typeof t.value?(0,p._j)(t.value):t.value,e.next=6,null===n||void 0===n?void 0:n.writeValueWithResponse(r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"writeWithoutResponse",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCharacteristic(t);case 2:return n=e.sent,r="string"===typeof t.value?(0,p._j)(t.value):t.value,e.next=6,null===n||void 0===n?void 0:n.writeValueWithoutResponse(r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readDescriptor",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDescriptor(t);case 2:return n=e.sent,e.next=5,null===n||void 0===n?void 0:n.readValue();case 5:return r=e.sent,e.abrupt("return",{value:r});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"writeDescriptor",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n,r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getDescriptor(t);case 2:return n=e.sent,r="string"===typeof t.value?(0,p._j)(t.value):t.value,e.next=6,null===n||void 0===n?void 0:n.writeValue(r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"startNotifications",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCharacteristic(t);case 2:return null===(n=e.sent)||void 0===n||n.removeEventListener("characteristicvaluechanged",this.onCharacteristicValueChangedCallback),null===n||void 0===n||n.addEventListener("characteristicvaluechanged",this.onCharacteristicValueChangedCallback),e.next=7,null===n||void 0===n?void 0:n.startNotifications();case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onCharacteristicValueChanged",value:function(e){var t,n,r=e.target,i="notification|".concat(null===(t=r.service)||void 0===t?void 0:t.device.id,"|").concat(null===(n=r.service)||void 0===n?void 0:n.uuid,"|").concat(r.uuid);this.notifyListeners(i,{value:r.value})}},{key:"stopNotifications",value:function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCharacteristic(t);case 2:return n=e.sent,e.next=5,null===n||void 0===n?void 0:n.stopNotifications();case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFilters",value:function(e){var t,n,i=[],a=(0,r.Z)(null!==(t=null===e||void 0===e?void 0:e.services)&&void 0!==t?t:[]);try{for(a.s();!(n=a.n()).done;){var s=n.value;i.push({services:[s],name:null===e||void 0===e?void 0:e.name,namePrefix:null===e||void 0===e?void 0:e.namePrefix})}}catch(u){a.e(u)}finally{a.f()}return((null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.namePrefix))&&0===i.length&&i.push({name:e.name,namePrefix:e.namePrefix}),i}},{key:"getDeviceFromMap",value:function(e){var t=this.deviceMap.get(e);if(void 0===t)throw new Error('Device not found. Call "requestDevice", "requestLEScan" or "getDevices" first.');return t}},{key:"getBleDevice",value:function(e){var t;return{deviceId:e.id,name:null!==(t=e.name)&&void 0!==t?t:void 0}}}]),n}(l.Uw)}}]);
//# sourceMappingURL=3665.795d3374.chunk.js.map